<div class="cabinet-page">
  <div class="login-wrap" *ngIf="!autentification">
    <div class="login-card">
      <div class="login-title">
        <h1 class="name-main">L2 Absolute</h1>
        <h4 class="subname-main">{{ 'title' | translate }}</h4>
      </div>
      <form class="form">
        <div class="form-group">
          <label for="username">{{ 'cabinet_login_1' | translate }}</label>
          <input type="text" id="username" [(ngModel)]="loginRequestDTO.login" name="login" class="form-control" [placeholder]="'cabinet_login_2' | translate" [disabled]="loginLoading" />
        </div>
        <div class="form-group">
          <label for="password">{{ 'cabinet_pass_1' | translate }}</label>
          <input type="password" id="password" [(ngModel)]="loginRequestDTO.password" name="password" class="form-control" [placeholder]="'cabinet_pass_2' | translate" [disabled]="loginLoading" />
        </div>
        <button type="button" class="btn primary" (click)="onSubmit()" [disabled]="loginLoading">
          {{ loginLoading ? ('cabinet.common.loadingDots' | translate) : ('cabinet_enter' | translate) }}
        </button>
      </form>
    </div>
  </div>

  <div class="cabinet-shell" *ngIf="autentification">
    <div class="cabinet-header">
      <div class="header-left"> 
        <div class="cabinet-brand">
          <div class="brand-title">L2 Absolute</div>
          <div class="brand-sub">{{ 'title' | translate }}</div>
        </div>

        <div class="tabs">
          <button class="tab-btn" [class.active]="activeTab==='info'" (click)="setTab('info')">
            {{ 'cabinet.tabs.info' | translate }}
          </button>
          <button class="tab-btn" [class.active]="activeTab==='characters'" (click)="setTab('characters')">
            {{ 'cabinet.tabs.characters' | translate }}
          </button>
          <button class="tab-btn" [class.active]="activeTab==='security'" (click)="setTab('security')">
            {{ 'cabinet.tabs.security' | translate }}
          </button>
        </div>
      </div>

      <div class="header-right">
        <div class="user-pill">
          <div class="user-pill__login">{{ loginAut }}</div>
          <div class="user-pill__role">{{ roleAut }}</div>
        </div>
        <button class="btn ghost" type="button" (click)="logout()">{{ 'cabinet.exit' | translate }}</button>
      </div>
    </div>

    <div class="cabinet-body">
      <div *ngIf="activeTab==='info'" class="panel">
        <div class="panel-title">{{ 'cabinet.section.info' | translate }}</div>

        <div class="grid">
          <div class="card">
            <div class="card-title">{{ 'cabinet.card.account' | translate }}</div>

            <div class="kv">
              <div class="k">{{ 'cabinet.field.login' | translate }}</div>
              <div class="v">{{ loginAut || ('cabinet.common.dash' | translate) }}</div>
            </div>

            <div class="kv">
              <div class="k">{{ 'cabinet.field.email' | translate }}</div>
              <div class="v">{{ l2email || ('cabinet.common.dash' | translate) }}</div>
            </div>

            <div class="kv">
              <div class="k">{{ 'cabinet.field.role' | translate }}</div>
              <div class="v">{{ roleAut || ('cabinet.common.dash' | translate) }}</div>
            </div>

            <div class="kv">
              <div class="k">{{ 'cabinet.field.language' | translate }}</div>
              <div class="v">{{ currentLanguage }}</div>
            </div>

            <div class="kv">
              <div class="k">{{ 'cabinet.field.sessionLeft' | translate }}</div>
              <div class="v">{{ getSessionExpiresText() }}</div>
            </div>

          </div>
        </div>
      </div>

      <div *ngIf="activeTab==='characters'" class="panel">
        <div class="panel-title">{{ 'cabinet.section.characters' | translate }}</div>

        <div class="grid grid-2">
          <div class="card">
            <div class="card-title">
              {{ 'cabinet.card.list' | translate }}
              <span class="muted" *ngIf="charactersLoading"> ({{ 'cabinet.characters.loading' | translate }})</span>
            </div>

            <div *ngIf="!charactersLoading && (!characters || characters.length===0)" class="empty">
              {{ 'cabinet_hero_null' | translate }}
            </div>

            <div class="char-list" *ngIf="characters && characters.length>0">
              <button type="button" class="char-item" *ngFor="let ch of characters" [class.active]="selectedCharacter?.objId === ch.objId" (click)="selectCharacter(ch)">
                <div class="char-name">{{ ch.charName }}</div>
                <div class="char-meta">
                  {{ 'cabinet.characters.levelShort' | translate }} {{ ch.lvl }} â€¢ {{ getClassLabel(ch) }}
                </div>
              </button>
            </div>
          </div>

          <div class="card">
            <div class="card-title">{{ 'cabinet.card.details' | translate }}</div>

            <div *ngIf="!selectedCharacter" class="empty">
              {{ 'cabinet.characters.selectHint' | translate }}
            </div>

            <div *ngIf="selectedCharacter" class="char-details">
              <div class="detail-row">
                <div class="k">{{ 'cabinet_rase' | translate }}</div>
                <div class="v">{{ getRaceLabel(selectedCharacter) }}</div>
              </div>
              <div class="detail-row">
                <div class="k">{{ 'cabinet_lvl' | translate }}</div>
                <div class="v">{{ selectedCharacter.lvl }}</div>
              </div>
              <div class="detail-row">
                <div class="k">{{ 'cabinet_class' | translate }}</div>
                <div class="v">{{ getClassLabel(selectedCharacter) }}</div>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title">{{ 'cabinet.card.actions' | translate }}</div>
          <button class="btn primary" type="button" (click)="onGetCharacters()" [disabled]="charactersLoading">
            {{ charactersLoading ? ('cabinet.common.loadingDots' | translate) : ('cabinet.actions.refreshCharacters' | translate) }}
          </button>
        </div>
      </div>

      <div *ngIf="activeTab==='security'" class="panel">
        <div class="panel-title">{{ 'cabinet.section.security' | translate }}</div>

        <div class="grid">
          <div class="card">
            <div class="card-title">{{ 'cabinet.changeEmail.startChangeEmail' | translate }}</div>

            <p class="hint" *ngIf="!emailCodeSent">{{ 'cabinet.changeEmail.hint' | translate }}</p>

            <button class="btn primary" type="button" (click)="requestEmailChangeCode()" [disabled]="emailChangeLoading" *ngIf="!emailCodeSent">
              {{ (emailChangeLoading ? 'cabinet.changeEmail.sending' : 'cabinet.changeEmail.sendCode') | translate }}
            </button>

            <div *ngIf="emailCodeSent">
              <div class="form-group">
                <label>{{ 'cabinet.changeEmail.newEmailLabel' | translate }}</label>
                <input type="email" class="form-control" [(ngModel)]="emailChangeConfirmDTO.newEmail" name="newEmail" [placeholder]="'cabinet.changeEmail.newEmailPlaceholder' | translate" [disabled]="emailChangeLoading" />
              </div>

              <div class="form-group">
                <label>{{ 'cabinet.changeEmail.codeLabel' | translate }}</label>
                <input type="text" class="form-control" [(ngModel)]="emailChangeConfirmDTO.code" name="emailChangeCode" [placeholder]="'cabinet.changeEmail.codePlaceholder' | translate" [disabled]="emailChangeLoading" />
              </div>

              <button class="btn primary" type="button" (click)="confirmEmailChange()" [disabled]="emailChangeLoading">
                {{ (emailChangeLoading ? 'cabinet.changeEmail.checking' : 'cabinet.changeEmail.confirm') | translate }}
              </button>

              <button class="btn secondary" type="button" (click)="requestEmailChangeCode()" [disabled]="emailChangeLoading">
                {{ 'cabinet.changeEmail.resend' | translate }}
              </button>

              <button class="btn ghost" type="button" (click)="cancelEmailChange()" [disabled]="emailChangeLoading">
                {{ 'cabinet.changeEmail.cancel' | translate }}
              </button>
            </div>
          </div>

          <div class="card">
            <div class="card-title">{{ 'cabinet.card.session' | translate }}</div>
            <div class="kv">
              <div class="k">{{ 'cabinet.field.sessionLeft' | translate }}</div>
              <div class="v">{{ getSessionExpiresText() }}</div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
