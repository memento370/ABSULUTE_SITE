<div>
  <h1 class="name-main">L2 Absolute</h1>
  <h4 class="subname-main">{{ 'title' | translate }}</h4>
</div>
<div class="registration-form" *ngIf="!autentification">
  <form>
    <div class="form-group">
      <label for="username">{{ 'cabinet_login_1' | translate }}</label>
      <input type="text" id="username" [(ngModel)]="loginRequestDTO.login" name="login" required class="form-control" placeholder="{{ 'cabinet_login_2' | translate }}">
    </div>
    <div class="form-group">
      <label for="password">{{ 'cabinet_pass_1' | translate }}</label>
      <input type="password" id="password" [(ngModel)]="loginRequestDTO.password" name="password" required class="form-control" placeholder="{{ 'cabinet_pass_2' | translate }}">
    </div>
    <button type="button" class="btn" (click)="onSubmit()">{{ 'cabinet_enter' | translate }}</button>
  </form>
</div>
<div class="registration-form" *ngIf="autentification">
  <ng-container *ngIf="!isEmailChangeOpen; else emailChangeBlock">
    <form>
      <div class="form-group" *ngIf="characters && characters.length > 0">
        <label for="characterSelect">{{ 'cabinet_hero' | translate }}</label>
        <select id="characterSelect"
                class="form-control"
                [(ngModel)]="selectedCharacter"
                name="characterSelect">
          <option *ngFor="let character of characters" [ngValue]="character">
            {{ character.charName }}
          </option>
        </select>
      </div>
      <div class="form-group" *ngIf="!characters || characters.length === 0">
        <h4>{{ 'cabinet_hero_null' | translate }}</h4>
      </div>
    </form>

    <div class="character-details" *ngIf="selectedCharacter">
      <p>{{ 'cabinet_rase'  | translate }} : {{ selectedCharacter.raceRu }}</p>
      <p>{{ 'cabinet_lvl'   | translate }} : {{ selectedCharacter.lvl }}</p>
      <p>{{ 'cabinet_class' | translate }} : {{ selectedCharacter.classRu }}</p>
    </div>

    <div class="divider"></div>
    <button class="btn btn-secondary" type="button" (click)="toggleEmailChange()">{{ 'cabinet.changeEmail.startChangeEmail' | translate }}</button>
  </ng-container>

  <ng-template #emailChangeBlock>
    <div>
      <p class="hint" *ngIf="!emailCodeSent">
        {{ 'cabinet.changeEmail.hint' | translate }}
      </p>

      <button
        class="btn"
        type="button"
        (click)="requestEmailChangeCode()"
        [disabled]="emailChangeLoading"
        *ngIf="!emailCodeSent"
      >
        {{ (emailChangeLoading ? 'cabinet.changeEmail.sending' : 'cabinet.changeEmail.sendCode') | translate }}
      </button>

      <div *ngIf="emailCodeSent">
        <div class="form-group">
          <label>{{ 'cabinet.changeEmail.newEmailLabel' | translate }}</label>
          <input
            type="email"
            class="form-control"
            [(ngModel)]="emailChangeConfirmDTO.newEmail"
            name="newEmail"
            [placeholder]="'cabinet.changeEmail.newEmailPlaceholder' | translate"
            [disabled]="emailChangeLoading"
          />
        </div>

        <div class="form-group">
          <label>{{ 'cabinet.changeEmail.codeLabel' | translate }}</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="emailChangeConfirmDTO.code"
            name="emailChangeCode"
            [placeholder]="'cabinet.changeEmail.codePlaceholder' | translate"
            [disabled]="emailChangeLoading"
          />
        </div>

        <button class="btn" type="button" (click)="confirmEmailChange()" [disabled]="emailChangeLoading">
          {{ (emailChangeLoading ? 'cabinet.changeEmail.checking' : 'cabinet.changeEmail.confirm') | translate }}
        </button>

        <button
          class="btn"
          type="button"
          (click)="requestEmailChangeCode()"
          [disabled]="emailChangeLoading"
          style="margin-top: 10px;"
        >
          {{ 'cabinet.changeEmail.resend' | translate }}
        </button>
      </div>

      <button
        class="btn btn-secondary"
        type="button"
        (click)="toggleEmailChange()"
        [disabled]="emailChangeLoading"
        style="margin-top: 10px;"
      >
        {{ 'cabinet.changeEmail.cancel' | translate }}
      </button>
    </div>
  </ng-template>

  <button class="btn" (click)="logout()">{{ 'cabinet.exit' | translate }}</button>
</div>

